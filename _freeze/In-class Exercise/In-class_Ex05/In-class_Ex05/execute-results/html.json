{
  "hash": "9427bc3be606e3449fa71259bff79043",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-class Ex 05: Global and Local Measures of Spatial Autocorrelation:sfdep methods\"\nauthor: \"Liang Xiuhao Rydia\"\ndate: \"Sep 23, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\nformat: \n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n---\n\n\n### Tobler’s First law of Geography\n\n**\"Everything is related to everything else, but near things are more related than distant things.\"**\n\n## 1.0 Measures of Global Spatial Autocorrelation\n\n### 1.1 Moran’s I\n\nDescribe how features differ from the values in the study area as a whole.\n\n![](images/clipboard-697053390.png)\n\nx~i~ = observed value\n\nx-bar = whole study area\n\nx~j~ = neighbour (affected by weight, W~ij~)\n\n-   Moran I (Z value) is:\n\n    -   positive (I\\>0): Clustered, observations tend to be similar;\n\n    -   negative(I\\<0): Dispersed, observations tend to be dissimilar;\n\n    -   approximately zero: observations are arranged randomly over space.\n\n## 1.2 Geary’s c\n\nDescribing how features differ from their immediate neighbours.\n\n![](images/clipboard-1913619110.png)\n\n-   Geary c (Z value) is:\n\n    -   Large c value (\\>1) : Dispersed, observations tend to be dissimilar;\n\n    -   Small c value (\\<1) : Clustered, observations tend to be similar;\n\n    -   c = 1: observations are arranged randomly over space.\n\n## Measures of Global High/Low Clustering: Getis-Ord Global G\n\n-   Getis-Ord Global G statistic is concerned with the overall concentration or lack of concentration in all pairs that are neighbours given the definition of neighbouring areas.\n\n-   The variable must contain only positive values to be used.\n\n![](images/clipboard-3148702620.png)\n\n-   G(d) is a distance-based matrix. Do not use contiguity matrix.\n\n## 1.3 Differences from lesson 2 & 3\n\n-   Only look at point events (accidents) -\\> spatial point pattern analysis.\n\n## 2.0 In-class Exercise with sfdep\n\n-   sfdep() is based on sf dataframe.\n\n-   tidyverse framework.\n\n-   sfdep() is wrapper of spdep()\n\n### 2.1 Getting started\n\nInstalling and Loading the R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf,\n               sfdep,\n               tmap,\n               tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhunan <- st_read(dsn = \"data/geospatial\", \n                 layer = \"Hunan\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Hunan' from data source \n  `C:\\rydialiang\\isss626-aug24\\In-class Exercise\\In-class_Ex05\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 88 features and 7 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 108.7831 ymin: 24.6342 xmax: 114.2544 ymax: 30.12812\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhunan2012 <- read_csv(\"data/aspatial/Hunan_2012.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhunan <- left_join(hunan,hunan2012) %>%\n  dplyr::select(1:4, 7, 15)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nequal <- tm_shape(hunan) +\n  tm_fill(\"GDPPC\",\n          n = 5,\n          style = \"equal\") +\n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"Equal interval classification\")\n\nquantile <- tm_shape(hunan) +\n  tm_fill(\"GDPPC\",\n          n = 5,\n          style = \"quantile\") +\n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"Equal quantile classification\")\n\ntmap_arrange(equal, \n             quantile, \n             asp=1, \n             ncol=2)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex05_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q <- hunan %>% \n  mutate(nb = st_contiguity(geometry),\n         wt = st_weights(nb,\n                         style = \"W\"),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI <- global_moran_test(wm_q$GDPPC,\n                       wm_q$nb,\n                       wm_q$wt)\n\nglimpse(moranI)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 6\n $ statistic  : Named num 4.74\n  ..- attr(*, \"names\")= chr \"Moran I statistic standard deviate\"\n $ p.value    : num 1.09e-06\n $ estimate   : Named num [1:3] 0.30075 -0.01149 0.00435\n  ..- attr(*, \"names\")= chr [1:3] \"Moran I statistic\" \"Expectation\" \"Variance\"\n $ alternative: chr \"greater\"\n $ method     : chr \"Moran I test under randomisation\"\n $ data.name  : chr \"x  \\nweights: listw    \\n\"\n - attr(*, \"class\")= chr [1:2] \"htest\" \"list\"\n```\n\n\n:::\n:::\n\n\nUse global Moran I to test for randomisation.\n\nCheck compare p-value with alpha. If p-value is smaller than alpha, we reject Null hypothesis and there is statistical significance.\n\nMoran I statistic is 0.300749970, positive.\n\n## Performing Global Moran I permutation test\n\nIn practice,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345)\nglobal_moran_perm(wm_q$GDPPC,\n                  wm_q$nb,\n                  wm_q$wt,\n                  nsim =99)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 100 \n\nstatistic = 0.30075, observed rank = 100, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa <- wm_q %>% \n  mutate(local_moran = local_moran(GDPPC,\n                                   nb,wt,\n                                   nsim = 99),\n         .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n-   unnest the table, write back to tibble data frame instead of one object.\n\nVisualising local Moran I and p-value\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_fill(\"p_ii_sim\") +\n  tm_borders(alpha = 0.5) +\n    tm_layout(main.title = \"p-value of local Moran's I\",\n            main.title.size = 2)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex05_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nVisualising local Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_fill(\"ii\") +\n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n    tm_layout(main.title = \"Local Moran's I of GDPPC\",\n            main.title.size = .9)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex05_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_fill(\"ii\") +\n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n    tm_layout(main.title = \"Local Moran's I of GDPPC\",\n            main.title.size = 2)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex05_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nLISA Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_sig <- lisa %>% \n  filter(p_ii < 0.05)\n\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_sig) +\n  tm_fill(\"mean\") +\n  tm_borders(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex05_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_idw <- hunan_GDPPC %>% \n  mutate(st_contiguity())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA <- wm_idw %>% \n  mutate(local_Gi = local_gstar_perm(\n    GDPPC, nb,wt, nsim =99),\n    .before = 1) %>% \n  unnest(local_Gi)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nHCSA_sig <- HCSA %>% \n  filter(p_sim < 0.05)\ntmap_mode(\"plot\")\ntm_shape(HCSA) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(HCSA_sig) +\n  tm_fill(\"cluster\") +\n  tm_borders(alpha = 0.4)\n```\n:::\n",
    "supporting": [
      "In-class_Ex05_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}